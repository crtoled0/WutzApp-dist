!function(e,n,t){"use strict";var a={_version:.2,_config:{defaultLang:"en"},_cacheOnMemory:{},_barInSession:"",_tempImages:[],loadBarCachedInfo:function(n,t,a,o){var s=this;s._barInSession=n;var c=s._cacheOnMemory[n];c||(c=JSON.parse(e.localStorage.getItem(n)),c?s._cacheOnMemory[n]=c:(s.createNewBar(t,a),c=s._cacheOnMemory[n])),c.catId===t&&c.catVers===a?o&&o(c):r(n,c.catId,function(){s._cacheOnMemory[n]={catId:t,catVers:a},o&&o({newbar:!0})})},setBarIdInSession:function(e){this._barInSession=e},getBarIdInSession:function(){return this._barInSession},createNewBar:function(n,t){var a=this,o=a._barInSession,r={catId:n,catVers:t};a._cacheOnMemory[o]=r,e.localStorage.setItem(o,JSON.stringify(r))},addArtists:function(n){var t=this,a=t._barInSession;void 0===t._cacheOnMemory[a].artists&&(t._cacheOnMemory[a].artists=n,e.localStorage.setItem(a,JSON.stringify(t._cacheOnMemory[a])))},addAlbums:function(n,t){var a=this,o=a._barInSession,r=!1;void 0===a._cacheOnMemory[o].albums?(a._cacheOnMemory[o].albums={},r=!0):void 0===a._cacheOnMemory[o].albums[n]&&(r=!0),r&&(a._cacheOnMemory[o].albums[n]=t,e.localStorage.setItem(o,JSON.stringify(a._cacheOnMemory[o])))},addSongs:function(e,n){var t=this,a=t._barInSession;t._cacheOnMemory[a].songs||(t._cacheOnMemory[a].songs={}),t._cacheOnMemory[a].songs[e]=n,localStorage.setItem(a,JSON.stringify(t._cacheOnMemory[a]))},getArtists:function(){var e=this,n=e._barInSession;return e._cacheOnMemory[n].artists},getAlbums:function(e){var n=this,t=n._barInSession;return n._cacheOnMemory[t].albums?n._cacheOnMemory[t].albums[e]:void 0},getSongs:function(e){var n=this,t=n._barInSession;return n._cacheOnMemory[t].songs?n._cacheOnMemory[t].songs[e]:void 0},getBarCachedCatalog:function(){var e=this,n=e._barInSession;return e._cacheOnMemory[n]},startIndexingCatalog:function(){var e=this,n=e._barInSession,t=e._cacheOnMemory[n].artists,a=t.length,o=0,r=0,c=setInterval(function(){e.indexArtist(t[r],function(){o++,console.log(o)}),++r>=a&&(clearInterval(c),s(e._tempImages),e.catchAllSongs())},100)},indexArtist:function(n,t){var a=this,r=a._barInSession,s=a.getAlbums(n.idartist)?a.getAlbums(n.idartist):[];if(console.log("Indexing "+n.idartist),0===s.length)e.wutzAdmin.callService({service:"getAlbumPerArtist/"+a._cacheOnMemory[r].catId+"/"+n.idartist},function(e){for(var r in e)e[r].lfm_img_url=e[r].lfm_img_url?e[r].lfm_img_url:"./img/logo.png",a._tempImages.push(e[r].lfm_img_url),e[r].idartist=n.idartist,s.push(e[r]),o.push(e[r]);a.addAlbums(n.idartist,s),t()});else{for(var c in s)a._tempImages.push(s[c].lfm_img_url);t()}},catchAllSongs:function(){var e=this,n=e._barInSession,t=e._cacheOnMemory[n].catId,a=o.length,r=0,s=0,c=setInterval(function(){e.indexAlbumSongs(o[r],t,function(){++s>=a&&(e._cacheOnMemory[n].indexed=!0,console.log(n+": Indexed "))}),++r>=a&&clearInterval(c)},100)},indexAlbumSongs:function(e,n,t){var a=this;console.log("Caching Song Album "+e.name),0===(a.getSongs(e.idalbum)?a.getSongs(e.idalbum):[]).length?c(e.idalbum,n,function(e,n){a.addSongs(e,n),t()}):t()},onCatalogIndexed:function(e){var n=this,t=n._barInSession,a=setInterval(function(){n._cacheOnMemory[t].indexed&&(clearInterval(a),e())},100)}},o=[],r=function(e,n,t){localStorage.removeItem(e);var o=localStorage.getItem("tokenCache");o&&(delete o[e],localStorage.setItem("tokenCache",o),delete a._cacheOnMemory[e]),void 0!==t&&t()},s=function(e){var n={},t=0,a=e.length,o=setInterval(function(){n[e[t]]||(console.log("Loading "+e[t]),n[e[t]]=new Image,n[e[t]].src=e[t]),++t>=a&&clearInterval(o)},100)},c=function(n,t,a){e.wutzAdmin.callService({service:"getSongsPerAlbum/"+t+"/"+n},function(e){a(n,JSON.parse(JSON.stringify(e)))})},i=function(){};i.prototype=a,i=new i,e.wtzCache=i}(window,document);